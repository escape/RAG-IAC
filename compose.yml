services:
  ollama:
    image: ollama/ollama:latest
    ports: ["${OLLAMA_PORT}:11434"]      # e.g. 11435:11434
    volumes:
      - ollama-data:/root/.ollama        # refer to the static key below
    healthcheck:
      test: ["CMD", "ollama", "list"]
      interval: 10s
      timeout: 2s
      retries: 20

  weaviate:
    image: semitechnologies/weaviate:1.31.2
    ports: ["${WEAVIATE_PORT}:8080"]     # e.g. 8081:8080
    environment:
      - QUERY_DEFAULTS_LIMIT=25
      - PERSISTENCE_DATA_PATH=/var/lib/weaviate
      - AUTHENTICATION_ANONYMOUS_ACCESS_ENABLED=true
      - AUTOSCHEMA_ENABLED=true
      - DEFAULT_VECTORIZER_MODULE=none  # e.g. text2vec-nomic-embed-text
    volumes:
      - weaviate-data:/var/lib/weaviate  # refer to the static key below
    healthcheck:
      test: ["CMD", "bash", "-lc", "wget -qO- localhost:8080/v1/.well-known/ready"]
      interval: 10s
      timeout: 2s
      retries: 30

  # OPTIONAL
  openwebui:
    image: ghcr.io/open-webui/open-webui:main
    depends_on: [ollama]
    ports: ["3001:8080"]
    environment:
      - OLLAMA_BASE_URL=http://ollama:11434

  # OPTIONAL
  jupyter:
    image: jupyter/minimal-notebook:latest
    depends_on: [ollama, weaviate]
    ports: ["8889:8888"]
    environment:
      - JUPYTER_TOKEN=dev
    volumes:
      - ./notebooks:/home/jovyan/work
      - ./scripts:/home/jovyan/scripts
      - ./data:/home/jovyan/data

volumes:
  ollama-data: {}
  weaviate-data: {}
